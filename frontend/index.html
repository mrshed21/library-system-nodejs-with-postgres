<!DOCTYPE html>
<html lang="sv">
  <head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <title>Bibliotek – Böcker & Genrer</title>
    <link rel="stylesheet" href="style.css" />
  </head>
  <body>
    <h1>Bibliotek</h1>

    <section>
      <h2>Genrer</h2>
      <ul id="genres" class="genre-list">
        <li class="loading">Laddar genrer…</li>
      </ul>
    </section>

    <section>
      <h2>Lägg till bok</h2>
      <form id="book-form" class="book-form">
        <label for="book-name">Titel</label>
        <input type="text" id="book-name" name="name" required />
        <label for="book-price">Pris</label>
        <input
          type="number"
          id="book-price"
          name="price"
          min="10"
          step="0.01"
          required
        />
        <label for="book-stock">Antal</label>
        <input type="number" id="book-stock" name="stock" min="0" required />
        <label for="book-author">Författare</label>
        <select id="book-author" name="author_id" required></select>
        <button type="submit">Lägg till bok</button>
      </form>
    </section>

    <section>
      <h2>Böcker</h2>
      <ul id="books" class="book-list">
        <li class="loading">Laddar böcker…</li>
      </ul>
    </section>
    <script src="ui.js"></script>
    <script>
      const API = "/api"; // For local API
      // const API = 'http://localhost:3000/api'; // For external API

      async function loadGenres() {
        const el = document.getElementById("genres");
        try {
          const res = await fetch(`${API}/genres`);
          if (!res.ok) throw new Error(res.statusText);
          const genres = await res.json();
          renderGenres(genres);
        } catch (err) {
          el.innerHTML = `<li class="error">Kunde inte ladda genrer: ${escapeHtml(
            err.message
          )}</li>`;
        }
      }

      async function loadBooks() {
        const el = document.getElementById("books");
        try {
          const res = await fetch(`${API}/books`);
          if (!res.ok) throw new Error(res.statusText);
          const books = await res.json();
          renderBooks(books);
        } catch (err) {
          el.innerHTML = `<li class="error">Kunde inte ladda böcker: ${escapeHtml(
            err.message
          )}</li>`;
        }
      }

      loadGenres();
      loadBooks();
      initBookForm(API, { onSuccess: loadBooks });
    </script>
  </body>
</html>
